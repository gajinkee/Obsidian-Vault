# Post Exploit Methodology
1. Local enum
2. Transfer files
3. Upgrading shells
4. Priv esc
5. Persistence
6. Dumping/cracking hashes (NTLM/unshadowed pwd)
7. Pivoting
8. Clearing Tracks
-> process repeats until whole network compromised

Note:
2 & 3 optional


## Local Enum
- system info Eg
	- Hostname -> useful for user enum (sometimes named as user)
	- OS name/build/servicepack/architecture -> useful for priv esc
	- Installed updates
Demo:
`getuid`
`sysinfo`
`cd C:\\Windows\System32 && cat eula.txt` 
-> does not exist on every version of windows but gives info on build etc

On shell
`hostname`
`systeminfo` -->  gives info for hotfixes/patches
`wmic qfe get Caption,Description,HotFixID,Installation`
-> info about each specific hotfix (concerned with Security Update)

##### User and groups Enum

getuid
getprivs

/windows/gather/enum_logged_on_users

shell
`whoami`
`whoami /priv`
`query user` -> see if any other users logged on

`net users` -> all users on the system
`net user <username>` -> info about a user

`net users localgroup` -> groups on the system

`net localgroup <groupname>`  -> members in a group eg administrator

##### Enumerate network info
- internal network for pivoting
- firewall state for backdoor etc

shell
`ipconfig`
`ipconfig /all` -> see if DHCP enabled meaning the ip could change

`route print` -> list out the route table

`arp -a` 
-> arp table list other devices on the network
-> many with 225 and static are related to the subnet mask, not interesting

`netstat -ano`
-> display list of open ports/services running

`netsh firewall show state`
or
`netsh advfirewall firewall show allprofiles`
-> find if a specific port is blocked etc

#### Enum process and services
- process is a instance of running exe
- service is a process running in background (ie daemon on linux)

Demo:
In meterpreter sess
`ps`
`pgrep explorer.exe` -> usually most stable
`migrate <pid>` 
-> take note of privs for each process
-> architecture of ps can be diff too

shell
`net start`
-> list of **services** started (running in bg)
`wmic service list brief`
-> list services diff format
`tasklist /SVC`
-> list processes and associated services
-> lookout for lsass.exe and svchost.exe

`schtasks /query /fo LIST`
`schtasks /query /fo LIST v`
->list scheduled tassk and services also verbose
-> look for scheduled task run as NT/Authority system etc that are misconfiged

#### Automate windows local enum
- JAWS powershell script

Demo:
WinRM running on -p5985
/winrm/winrm_script_exec

meterpreter
`show_mount`
-> see if there are xternal harddrives etc on the target sys

/gather/win_privs
/windows/gather/enum_logged_on_users
/gather/checkvm  -> check if in a vm
/gatehr/enum/applications

/gather/enum_computers
-> find other systems connected to the network (pivoting etc)

/gather/enum_patches

/gather/enum_shares

#### JAWS
goto github copy raw and paste locally notepad etc

sidenote: to paste into lab env ctrl+shift+alt

Meterpreter
mkdir TEMP
cd TEMP
upload /root/Desktop/jaws-enum.ps1

shell
`powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt`
-> enumerate all the info and ouput into a txt file
-> takes very long just wait
`download JAWS-enum.txt`